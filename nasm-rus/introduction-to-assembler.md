# Введение в ассемблер.
### Структура программы на NASM и ее компиляция
Код NASM имеет определенную структуру:
```nasm
section .data
; определяет константные данные (например: строки, магические числа).
section .bss
; резервирует пространство в памяти для будущих данных.
section .text
; содержит исполняемый код.
; _start:
; main:
```
Для того, чтобы собрать программу в Linux, нужно прописать команду в терминале:
```bash
nasm -f elf64 -g file.asm
```
После выполнения данной команды создастся файл `file.o`. Чтобы скомпилировать программу, можно воспользоваться *динамическим компановщиком*:
```bash
ld -m elf_x86_64 -o file file.o
```
Динамический компановщик берет файл `file.o` и превращает его в исполняемый файл. Динамический компановщик при выполнении ищет метку `_start`,
поэтому в `section .text` нужно использовать именно ее. `elf64` и `elf_x86_64` указывает на то, какой архитектурой процессора и  памятью мы пользуемся.

В конце программы на NASM нужно указать код выхода из программы:
```nasm
mov eax, 1
mov ebx, 0
int 80h
```
Если данное действие не будет выполнено, то будет вызвана ошибка: "Ошибка сегментации (стек памяти сброшен на диск)".

### Оталадка кода в Linux
Отладка программ, написанных на ассемблере в большинстве случаев производится с помощью инструмента - `gdb`. Вот ссылка на краткую памятку по синтаксису инструмента `gdb` - [Памятка по отладке](https://eax.me/gdb/).
#### Основная выкладка по инструменту `gdb`
Запуск проекта в `gdb`:
```bash
gdb -q pr-name
```
* `run` - Запутить программу.
* `break pr-name.asm:line-number` - Поставить точку остановы на определенный номер строки.
* `info b` - Информация по всем точкам остановы (`b` это то же самое, что и `break`).
* `d break-point-number` - Удалить точку остановы (если написать `b`, то будут удалены все точки остановы).
* `h` - Помощь по камандам инструмента `gdb`.
* `c` - Продолжить выполнение программы.
* `l` - Просмотреть исходный код программы.

### Регистры
Регистры: аппаратно реализованные переменные

![](https://i.ytimg.com/vi/RXbnp7BxQuA/maxresdefault.jpg)

На картинке видно, что регистры `EAX`, `EBX`, `ECX` и т.д. являются регистрами общего назначения. В них можно хранить любую информацию.<br>
Регистры `EBP`, `ESP`, `ESI`, `EDI` также являются регистрами общего назначения, однако имеют более конкретное предназначение, поэтому с ними нужно быть осторожнее.
Например, регистр `ESP` указывает на адрес вершины стека, а `EBP` указывает на адрес "глубины" стека.<br>
Регистры `ESI` и `EDI` используются для копирования большого количества данных.<br>

### Инструкции
`mov` - инструкция по перемещению данных. Например:
```nasm
mov dest, src
```
Кроме инструкции `mov` перемещения есть `movzx` и `movsx`. Инструкция `movzx` используется для перемещения данных из источника (второй операнд) *меньшего размера* в приемник (первый операнд) *большего размера*. Результат будет дополнен *нулевыми битами*. Инструкция `movsx` позволяет скопировать данные из источника (второй операнд) *меньшего размера* в приемник (первый операнд) *большего размера*. Результат будет дополнен битами таким образом, чтобы *сохранить знак источника*.
